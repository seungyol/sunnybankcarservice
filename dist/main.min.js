/*! 2016-11-14 */
!function(){"use strict";angular.module("commonApp",[]),angular.module("userEdit",["ngRoute","ngMaterial","ngMessages","ngResource","ui.bootstrap","commonApp"]),angular.module("customer",["ngRoute","ngMaterial","ngMessages","ui.bootstrap","commonApp"]),angular.module("myApp",["ngRoute","ngMaterial","ngMessages","ui.bootstrap","customer","userEdit","commonApp"]).run(["$rootScope",function(a){a.loginResult=null}]).config(["$locationProvider","$routeProvider","$mdDateLocaleProvider",function(a,b,c){c.formatDate=function(a){return a?moment(a).format("DD/MM/YYYY"):""},c.parseDate=function(a){var b=moment(a,"DD/MM/YYYY",!0);return b.isValid()?b.toDate():new Date(NaN)},a.hashPrefix("!"),b.when("/customer-list",{template:"<customer-list></customer-list>"}).when("/login",{templateUrl:"login/login.html",controller:"LoginCtrl"}).when("/customer-edit/:id",{template:"<customer-edit></customer-edit>"}).when("/invoice-list",{templateUrl:"invoice/invoice-list.html",controller:"InvoiceListController"}).when("/previous-list",{templateUrl:"invoice/previous-list.html",controller:"PreviousListController"}).when("/quote-list",{templateUrl:"invoice/quote-list.html",controller:"QuoteListController"}).when("/unpaid-list",{templateUrl:"invoice/unpaid-list.html",controller:"UnpaidListController"}).when("/invoice-edit/:ID/:CustomersID/:CustomerCarsID",{templateUrl:"invoice/invoice-edit.html",controller:"InvoiceEditController"}).when("/user-list",{templateUrl:"user/user-list.html",controller:"UserListController"}).when("/user-edit/:ID",{template:"<user-edit></user-edit>"}).when("/setlement",{templateUrl:"settlement/settlement.html",controller:"SettlementController"}).when("/partinvoice-list",{templateUrl:"partinvoice/partinvoice-list.html",controller:"PartInvoiceListController"}).otherwise({redirectTo:"/login"})}])}(),angular.module("myApp").directive("focusMe",["$timeout","$parse","$window",function(a,b,c){return{link:function(d,e,f){var g=b(f.focusMe);d.$watch(g,function(b){b===!0&&a(function(){c.setTimeout(function(){e[0].focus(),e[0].focus()},100)})}),e.bind("blur",function(){d.$apply(g.assign(d,!1))})}}}]),angular.module("myApp").directive("validNumber",function(){return{require:"?ngModel",link:function(a,b,c,d){d&&(d.$parsers.push(function(a){angular.isUndefined(a)&&(a="");var b=a.replace(/[^-.0-9]+/g,"");return a!==b&&(d.$setViewValue(b),d.$render()),b}),b.bind("keypress",function(a){32===a.keyCode&&a.preventDefault()}))}}}),angular.module("commonApp").factory("AppAlert",["$rootScope",function(a){a.alerts=[];var b={add:function(c,d,e){a.alerts.push({type:c,msg:d,close:function(){b.closeAlert(this),e&&e()}})},closeAlert:function(c){b.closeAlertIdx(a.alerts.indexOf(c))},closeAlertIdx:function(b){a.alerts.splice(b,1)}};return b}]),angular.module("commonApp").factory("AuthFactory",["$rootScope","$location",function(a,b){return{checkLogin:function(){null===sessionStorage.getItem("CompaniesID")&&(alert("You must login first!"),b.path("/login"))},getLoginDetail:function(){return{ID:sessionStorage.getItem("ID"),FirstName:sessionStorage.getItem("FirstName"),LastName:sessionStorage.getItem("LastName"),Email:sessionStorage.getItem("Email"),RolesID:sessionStorage.getItem("RolesID"),RoleName:sessionStorage.getItem("RoleName"),CompaniesID:sessionStorage.getItem("CompaniesID")}},setLoginDetail:function(a){sessionStorage.setItem("ID",a.ID),sessionStorage.setItem("FirstName",a.FirstName),sessionStorage.setItem("LastName",a.LastName),sessionStorage.setItem("Email",a.Email),sessionStorage.setItem("RolesID",a.RolesID),sessionStorage.setItem("RoleName",a.RoleName),sessionStorage.setItem("CompaniesID",a.CompaniesID)},logout:function(){sessionStorage.removeItem("ID"),sessionStorage.removeItem("FirstName"),sessionStorage.removeItem("LastName"),sessionStorage.removeItem("Email"),sessionStorage.removeItem("RolesID"),sessionStorage.removeItem("RoleName"),sessionStorage.removeItem("CompaniesID")}}}]),angular.module("commonApp").factory("CarFactory",["$http","AppAlert","$route",function(a,b,c){return{SaveCar:function(d,e,f,g){var h=$.param({caraction:"SAVE",CustomerCarsID:d.ID,CustomersID:e,CarModelsID:d.CarModelsID,RegNo:d.RegNo,model:d.ModelName,Year:d.Year,VIN:d.VIN,EngineNo:d.EngineNo,ManualTransmissionYN:d.ManualTransmissionYN,CompaniesID:f,make:d.CarMakersID});a.post("server/SaveCar.php",h,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).success(function(a){a.affectedRow>=1&&b.add("success","SAVE SUCCESS",function(){g.$dismiss("close"),c.reload()})})},DeleteCar:function(d,e){var f=$.param({caraction:"DELETE",CustomerCarsID:d.ID});a.post("server/SaveCar.php",f,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).success(function(a){a.affectedRow>=1&&b.add("success","DELETE SUCCESS",function(){e.$dismiss("close"),c.reload()})})}}}]),angular.module("commonApp").factory("ConfirmFactory",["$rootScope","$uibModal","$log",function(a,b,c){var d={};return d.open=function(a,d,e){var f={};f.title=a,f.content=d;var g=b.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",controllerAs:"$ctrl",resolve:{message:function(){return f}}});g.result.then(function(a){e&&e()},function(){c.info("Cancel Clicked : "+new Date)})},d}]),angular.module("myApp").controller("ModalInstanceCtrl",["$uibModalInstance","message","$scope",function(a,b,c){var d=this;d.message=b,d.ok=function(){a.close()},d.cancel=function(){a.dismiss("cancel")}}]),angular.module("commonApp").factory("CustomerFactory",["$http","AuthFactory","AppAlert","$route","ConfirmFactory","$location",function(a,b,c,d,e,f){return{AddBlankCustomer:function(){var d=$.param({action:"SAVE",CustomersID:0,Title:null,FirstName:null,LastName:null,Phone:null,Mobile:null,Email:null,StreetAddress:null,suburb:null,state:null,postcode:null,CompaniesID:b.getLoginDetail().CompaniesID,Notes:null});a.post("server/SaveCustomer.php",d,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).success(function(a){1===parseInt(a.affectedRows,10)&&f.path("/customer-edit/"+a.ID)}).error(function(a){c.add("error","FAILURE. "+a)})},SaveCustomer:function(e){var f=$.param({action:"SAVE",CustomersID:e.ID,Title:e.Title,FirstName:e.FirstName,LastName:e.LastName,Phone:e.Phone,Mobile:e.Mobile,Email:e.Email,StreetAddress:e.StreetAddress,suburb:e.suburb,state:e.state,postcode:e.postcode,CompaniesID:b.getLoginDetail().CompaniesID,Notes:e.Notes});a.post("server/SaveCustomer.php",f,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).success(function(a){1===parseInt(a.affectedRows,10)?c.add("success","SAVE SUCCESS",d.reload):0===parseInt(a.affectedRows,10)&&c.add("warning","NO CHANGE")}).error(function(a){c.add("error","Error occurs!. "+a)})},DeleteCustomer:function(b){e.open("Delete Customer","Are you really want to delete the customer[ID : "+b.ID+"]?",function(){var d=$.param({action:"DELETE",CustomersID:b.ID});a.post("server/SaveCustomer.php",d,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).success(function(a){1===parseInt(a.affectedRows,10)?c.add("success","DELETE SUCCESS",function(){f.path("/customer-list")}):c.add("error","FAILURE")})})},SelectCustomer:function(b,c,d){var e=$.param({ID:b,CompaniesID:c});a.post("server/SelectCustomerDetail.php",e,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).success(function(a){d&&d(a)})}}}]),angular.module("commonApp").factory("InvoiceFactory",["$http","AuthFactory","AppAlert","$route","ConfirmFactory","$location",function(a,b,c,d,e,f){return{selectInvoice:function(b,c,d,e,g){a.get("server/SelectInvoiceDetail.php?ID="+b+"&CustomersID="+c+"&CustomerCarsID="+d+"&CompaniesID="+e).success(function(a){0===parseInt(b,10)?f.path("/invoice-edit/"+a.ID+"/"+c+"/"+d):g&&g(a)})},saveInvoice:function(b,d,e){var g=$.param({action:"SAVE",InvoicesID:b.ID,Odometer:b.Odometer,InvDate:d,JobDescription:b.JobDescription,ResultNotes:b.ResultNotes,PreviousYN:b.PreviousYN,QuotationYN:b.QuotationYN,FullyPaidYN:b.FullyPaidYN,amount:b.amount,PaidAmount:b.PaidAmount,PayMethodCd:b.PayMethodCd,PayDate:e,CustomerCarsID:b.CustomerCarsID,technician:b.UsersID});a.post("server/SaveInvoice.php",g,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).success(function(a){1===parseInt(a.trim(),10)?c.add("success","SAVE SUCCESS",function(){f.path("/invoice-edit/"+b.ID+"/"+b.CustomersID+"/"+b.CustomerCarsID)}):0===parseInt(a.trim(),10)?c.add("warning","NO CHANGE"):c.add("success","FAILURE")})},deleteInvoice:function(b){e.open("Delete Invoice","Are you really want to delete this invoice[ID:"+b.ID+"]?",function(){var d=$.param({action:"DELETE",InvoicesID:b.ID});a.post("server/SaveInvoice.php",d,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).success(function(a){1===parseInt(a,10)&&c.add("success","DELETE SUCCESS",function(){f.path("/customer-edit/"+b.CustomersID)})})})}}}]),angular.module("commonApp").factory("messageFactory",function(){return{successMessage:function(a,b,c){var d=$("div[ng-view]");b&&(d=$("div.modal-footer"));var e=$("<div class='alert alert-success' role='alert'></div>").html(a);d.before(e),e.show().animate({opacity:1},1e3,function(){setTimeout(function(){e.animate({opacity:0}),e.remove(),b&&d.closest(".modal").modal("hide"),c&&c()},2e3)})},errorMessage:function(a,b,c){var d=$("div[ng-view]");b&&(d=$("div.modal-footer"));var e=$("<div class='alert alert-danger' role='alert'></div>").html(a);d.before(e),e.show().animate({opacity:1},1e3,function(){setTimeout(function(){e.animate({opacity:0}),e.remove(),b&&d.closest(".modal").modal("hide"),c&&c()},2e3)})}}}),angular.module("commonApp").factory("numberFactory",function(){return{integerOnly:function(a,b){a.attr("maxlength",b),a.keydown(function(a){a.keyCode>=48&&a.keyCode<=57||a.keyCode>=96&&a.keyCode<=105||8===a.keyCode||37===a.keyCode||39===a.keyCode||46===a.keyCode||9===a.which||a.preventDefault()})}}}),angular.module("commonApp").factory("PartFactory",["$resource","AppAlert",function(a,b){return{savePart:function(c,d){var e=[];if(c.partname||e.push("PartName"),c.qty||e.push("Qty"),c.unitcost||e.push("UnitCost"),e.length>0)return b.add("warning","Mandatory inputs : "+e.join("  ")),!1;var f=a("server/SavePart.php",{},{save:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}});return f.save($.param(c),d)},deletePart:function(b,c){BootstrapDialog.confirm("Are you really want to delete this part ["+b.partname+"]?",function(d){if(d){var e=a("server/SavePart.php",{},{save:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}});return e.save($.param(b),c)}})}}}]),angular.module("commonApp").service("Suburb",["$q","$http","$resource",function(a,b,c){this.search=function(a){if(a.length>=3){var b=c("server/SelectPostCodes.php",{term:a}).query();return b.$promise}return[]}}]),angular.module("commonApp").service("User",["$resource",function(a){var b=a("server/SelectUserDetail.php");this.get=function(a,c,d){return b.get({ID:a,RolesID:c},d)};var c=a("server/ManageUser.php",{},{save:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}});this.save=function(a,b){return c.save(a,b)}}]),angular.module("myApp").filter("decimal2",function(){return function(a){return parseFloat(Math.round(100*a)/100).toFixed(2)}}),function(){"use strict";angular.module("myApp").controller("LoginCtrl",["$http","$scope","$rootScope","$location","AuthFactory","$window",function(a,b,c,d,e,f){$("body").addClass("full"),$(".menu").hide(),e.logout(),c.loginResult=null,$("#Password").keyup(function(a){a.which=a.which||a.keyCode,13===a.which&&$("button").click()}),b.shouldBeOpen=!0,b.Login=function(){var f="",g=$.param({Email:b.Email,Password:b.Password});return""===$("#Email").val()&&($("#Email").parent().addClass("has-error"),f+="Email is required\n"),""===$("#Password").val()&&($("#Password").parent().addClass("has-error"),f+="Password is required\n"),""!==f?(BootstrapDialog.alert(f),!1):void a.post("server/CheckLogin.php",g,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).success(function(a){var b={ID:a.ID,FirstName:a.FirstName,LastName:a.LastName,Email:a.Email,RolesID:a.RolesID,RoleName:a.RoleName,CompaniesID:a.CompaniesID};"SUCCESS"===a.Result?(e.setLoginDetail(b),c.loginResult=b,$("body").removeClass("full"),d.path("/customer-list").replace()):BootstrapDialog.alert(a.Message)}).error(function(a){})}}])}(),angular.module("customer").controller("CarDetailController",["$route","$scope","car","makers","$http","CompaniesID","CustomersID","AppAlert","numberFactory","CarFactory",function(a,b,c,d,e,f,g,h,i,j){function k(a){var c=a?b.models.filter(n(a)):b.models;return c}function l(a){null!=a&&(b.CarPopup.CarModelsID=a.value.split("|")[1],b.CarPopup.ModelName=a.display)}function m(){e.get("server/SelectCarModels.php?term=&CompaniesID="+f+"&CarMakersID="+b.CarPopup.CarMakersID).then(function(a){b.models=a.data.map(function(a){return{value:a.label.toLowerCase()+"|"+a.value,display:a.label}})})}function n(a){var b=angular.lowercase(a);return function(a){return 0===a.value.indexOf(b)}}b.shouldBeOpen=!0,b.makers=d,null==c&&(c={}),i.integerOnly($("#year"),4),b.CarPopup=c,b.CarModelsID=c.CarModelsID;c.Transmission;b.SaveCar=function(){null==b.CarPopup.CarModelsID&&(b.CarPopup.ModelName=$(".modal-dialog md-autocomplete input").val()),j.SaveCar(b.CarPopup,g,f,b)},b.DeleteCar=function(){j.DeleteCar(b.CarPopup,b)},b.changeMake=function(){m()},b.changeMake(),b.querySearch=k,b.selectedItemChange=l,b.selectedItem=c.ModelName}]),function(){"use strict";angular.module("customer").component("customerEdit",{templateUrl:"customer/customer-edit.html",controller:["$q","$location","$http","$routeParams","$route","AppAlert","ConfirmFactory","$uibModal","$rootScope","$scope","AuthFactory","CustomerFactory","Suburb",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){var b=h.open({animation:!0,templateUrl:"CarDetail.html",controller:"CarDetailController",controllerAs:"$ctrl",resolve:{car:function(){return a},makers:function(){return j.makers},CompaniesID:function(){return k.getLoginDetail().CompaniesID},CustomersID:function(){return d.id}}});b.result.then(function(a){},function(){})}return k.checkLogin(),i.loginResult=k.getLoginDetail(),0===parseInt(d.id,10)?void l.AddBlankCustomer():(j.querySearch=function(a){return m.search(a)},j.CarPopup={},j.SaveCustomer=function(){"string"==typeof j.selectedSuburb?j.cust.suburb=j.selectedSuburb:"object"==typeof j.selectedSuburb&&null!=j.selectedSuburb?j.cust.suburb=j.selectedSuburb.label:j.cust.suburb="",l.SaveCustomer(j.cust)},j.DeleteCustomer=function(){l.DeleteCustomer(j.cust)},j.GotoInvoice=function(a){b.path("/invoice-edit/"+a.ID+"/"+a.CustomersID+"/"+a.CustomerCarsID)},j.AddInvoice=function(){for(var a in j.custCars)if(j.custCars[a].checked===!0){b.path("/invoice-edit/0/"+j.cust.ID+"/"+j.custCars[a].ID);break}},j.GotoList=function(){b.path("/customer-list")},j.AddCar=n,j.showCar=n,j.selectCar=function(a){for(var b=0;b<j.custCars.length;b++)j.custCars[b].ID===a?j.custCars[b].checked=!0:j.custCars[b].checked=!1},void l.SelectCustomer(d.id,i.loginResult.CompaniesID,function(a){j.CompaniesID=k.getLoginDetail().CompaniesID,j.cust=a.cust,j.selectedSuburb=j.cust.suburb,j.selectedItemChange=function(a){"object"==typeof a&&(j.cust.state=a.value.split(",")[1],j.cust.postcode=a.value.split(",")[2],j.cust.suburb=a.display)},j.custCars=a.custCars,null!=j.custCars&&j.custCars.length>0&&(j.custCars[0].checked=!0),j.custInvoices=a.custInvoices,j.makers=a.makers}))}]})}(),function(){"use strict";angular.module("customer").component("customerList",{templateUrl:"customer/customer-list.html",controller:["$location","$scope","$rootScope","AuthFactory",function(a,b,c,d){d.checkLogin(),c.loginResult=d.getLoginDetail();$("#CustomerList").dataTable({columnDefs:[{render:function(a,b,c){return"<a href='#!/customer-edit/"+a+"'>"+a+"</a>"},targets:0},{render:function(a,b,c){return"<a href='#!/customer-edit/"+c.ID+"'>"+a+"</a>"},targets:1}],bJQueryUI:!0,processing:!0,serverSide:!0,ajax:"server/SelectCustomerList.php?CompaniesID="+c.loginResult.CompaniesID});b.goNew=function(){a.path("/customer-edit/0").replace()},$("button").button()}]})}(),function(){"use strict";angular.module("myApp").controller("InvoiceEditController",["$location","$http","$routeParams","$route","AppAlert","ConfirmFactory","AuthFactory","InvoiceFactory","PartFactory","$rootScope","$scope",function(a,b,c,d,e,f,g,h,i,j,k){function l(){$("#PartName").autocomplete({source:"server/SelectParts.php?CompaniesID="+j.loginResult.CompaniesID,minLength:2,focus:function(a,b){var c=b.item.value.split("|");return k.partdtl.partname=c[1],!1},select:function(a,b){var c=b.item.value.split("|");return k.partdtl.partname=c[1],k.partdtl.partsid=c[0],k.partdtl.unitcost=c[2],k.$apply(),!1}})}g.checkLogin(),j.loginResult=g.getLoginDetail(),k.partdtl={},k.invoice={},h.selectInvoice(c.ID,c.CustomersID,c.CustomerCarsID,j.loginResult.CompaniesID,function(a){k.car=a.car,k.invoice=a.invoice,k.invoice.InvDate=moment(a.invoice.InvDate,"DD/MM/YYYY").toDate(),k.invoice.PayDate=a.invoice.PayDate?moment(a.invoice.PayDate,"DD/MM/YYYY").toDate():null,k.invoice.amount=k.total(),k.customer=a.customer,k.users=a.users,k.paymethods=a.paymethods,k.invoice.ID>0&&("Y"===k.invoice.QuotationYN?k.title="Quote Details (No : "+k.invoice.ID+")":k.title="Invoice Details (No : "+k.invoice.ID+")")}),k.parts=[],b({method:"GET",url:"server/SelectInvoiceParts.php?ID="+c.ID}).success(function(a,b,c,d){for(var e=0;e<a.length;e++)k.parts.push(a[e])}).error(function(a,b,c,d){alert("error")}),k.total=function(){for(var a=0,b=0;b<k.parts.length;b++)a+=Number(k.parts[b].LineTotal.replace(/,/g,""));return a},k.changePaidAmount=function(){"Y"===k.invoice.FullyPaidYN&&0===Number(k.invoice.PaidAmount)&&(k.invoice.PaidAmount=k.total())},k.printQuote=function(){window.open("server/QuotePrint.php?ID="+k.invoice.ID+"&CustomersID="+k.invoice.CustomersID+"&CustomerCarsID="+k.invoice.CustomerCarsID+"&CompaniesID="+j.loginResult.CompaniesID,"_blank")},k.printInvoice=function(){window.open("server/InvoicePrint.php?ID="+k.invoice.ID+"&CustomersID="+k.invoice.CustomersID+"&CustomerCarsID="+k.invoice.CustomerCarsID+"&CompaniesID="+j.loginResult.CompaniesID,"_blank")},k.printJobOrder=function(){window.open("server/JobOrderPrint.php?ID="+k.invoice.ID+"&CustomersID="+k.invoice.CustomersID+"&CustomerCarsID="+k.invoice.CustomerCarsID+"&CompaniesID="+j.loginResult.CompaniesID,"_blank")},k.gotoCustomer=function(){a.path("/customer-edit/"+k.invoice.CustomersID)},k.part={},$("#divPartPopup").on("shown.bs.modal",function(){$("#PartName").focus(),$("#PartName").select()}),k.AddPart=function(){k.partdtl={},$("#divPartPopup").modal("show"),l(),k.isPartSaveDisabled=!1,k.isPartDeleteDisabled=!0},k.saveInvoice=function(){h.saveInvoice(k.invoice,moment(k.invoice.InvDate).format("DD/MM/YYYY"),moment(k.invoice.PayDate).format("DD/MM/YYYY"))},k.deleteInvoice=function(){h.deleteInvoice(k.invoice)},l(),k.open=function(a){$("#divPartPopup").modal("show"),k.partdtl.id=a.ID,k.partdtl.partsid=a.PartsID,k.partdtl.qty=a.Qty,k.partdtl.unitcost=a.UnitCost,k.partdtl.partname=a.PartName,k.isPartSaveDisabled=!1,k.isPartDeleteDisabled=!1};var m=function(a){var b={partaction:a,id:k.partdtl.id,partsid:k.partdtl.partsid,InvoicesID:k.invoice.ID,partname:k.partdtl.partname,qty:k.partdtl.qty,unitcost:k.partdtl.unitcost,CompaniesID:j.loginResult.CompaniesID};return b};k.savePart=function(a){k.isPartSaveDisabled=!0,k.isPartDeleteDisabled=!0,k.partdtl.partaction="SAVE",k.partdtl.CompaniesID=j.loginResult.CompaniesID,k.partdtl.InvoicesID=c.ID;var b=i.savePart(k.partdtl,function(a){if(Number(a.ID)>0)k.partdtl.id=a.ID,k.parts.push({ID:k.partdtl.id,PartsID:k.partdtl.partsid,Qty:k.partdtl.qty,UnitCost:k.partdtl.unitcost,PartName:k.partdtl.partname,LineTotal:(k.partdtl.qty*k.partdtl.unitcost).toFixed(2)});else for(var b=0;b<k.parts.length;b++)k.parts[b].ID===k.partdtl.id&&(k.parts[b].PartsID=k.partdtl.partsid,k.parts[b].Qty=k.partdtl.qty,k.parts[b].UnitCost=k.partdtl.unitcost,k.parts[b].PartName=k.partdtl.partname,k.parts[b].LineTotal=(k.parts[b].Qty*k.parts[b].UnitCost).toFixed(2));k.partdtl={},$("#PartName").focus(),k.isPartSaveDisabled=!1,k.isPartDeleteDisabled=!0});b===!0&&(k.isPartSaveDisabled=!1)},k.deletePart=function(){var a=m("DELETE");i.deletePart(a,function(a){for(var b=0;b<k.parts.length;b++)k.parts[b].ID===k.id&&k.parts.splice(b,1);$("#divPartPopup").modal("hide"),e.add("success","The part is deleted successfully!",d.reload)})}}])}(),function(){"use strict";angular.module("myApp").controller("InvoiceListController",["$location","$routeParams","AuthFactory","$rootScope","$scope",function(a,b,c,d,e){c.checkLogin(),d.loginResult=c.getLoginDetail(),$("#InvoiceList").DataTable({responsive:!0,columnDefs:[{responsivePriority:1,targets:0},{responsivePriority:2,targets:-1},{responsivePriority:3,targets:-1},{responsivePriority:4,targets:-1},{render:function(a,b,c){return"<a href='#!/invoice-edit/"+c.ID+"/"+c.CustomersID+"/"+c.CustomerCarsID+"'>"+a+"</a>"},targets:0}],processing:!0,serverSide:!0,ajax:"server/SelectInvoiceList.php?type="+b.type+"&CompaniesID="+d.loginResult.CompaniesID})}])}(),function(){"use strict";angular.module("myApp").controller("PreviousListController",["$location","$routeParams","AuthFactory","$rootScope","$scope",function(a,b,c,d,e){c.checkLogin(),d.loginResult=c.getLoginDetail(),$("#PreviousList").DataTable({columnDefs:[{render:function(a,b,c){return"<a href='#!/invoice-edit/"+c.ID+"/"+c.CustomersID+"/"+c.CustomerCarsID+"'>"+a+"</a>"},targets:0}],processing:!0,serverSide:!0,ajax:"server/SelectInvoiceList.php?type=P&CompaniesID="+d.loginResult.CompaniesID})}])}(),function(){"use strict";angular.module("myApp").controller("QuoteListController",["$location","$routeParams","AuthFactory","$rootScope","$scope",function(a,b,c,d,e){c.checkLogin(),d.loginResult=c.getLoginDetail(),$("#QuoteList").DataTable({columnDefs:[{render:function(a,b,c){return"<a href='#!/invoice-edit/"+c.ID+"/"+c.CustomersID+"/"+c.CustomerCarsID+"'>"+a+"</a>"},targets:0}],processing:!0,serverSide:!0,ajax:"server/SelectInvoiceList.php?type=Q&CompaniesID="+d.loginResult.CompaniesID})}])}(),function(){"use strict";angular.module("myApp").controller("UnpaidListController",["$location","$routeParams","AuthFactory","$rootScope","$scope",function(a,b,c,d,e){c.checkLogin(),d.loginResult=c.getLoginDetail(),$("#UnpaidList").DataTable({columnDefs:[{render:function(a,b,c){return"<a href='#!/invoice-edit/"+c.ID+"/"+c.CustomersID+"/"+c.CustomerCarsID+"'>"+a+"</a>"},targets:0}],processing:!0,serverSide:!0,ajax:"server/SelectInvoiceList.php?type=U&CompaniesID="+d.loginResult.CompaniesID})}])}(),angular.module("myApp").controller("PartInvoiceListController",["$route","AuthFactory","$rootScope","$http","$scope",function(a,b,c,d,e){function f(a,b,c){for(var d=a.length,e=0,f=0;f<d&&!(a[f]===b&&(e++,e>=c));f++);return a.substring(0,f)}b.checkLogin(),c.loginResult=b.getLoginDetail();$("#partlist").dataTable({columnDefs:[{render:function(a,b,c){if(null==c.InvoiceNos)return'<button type="button"  data-id="'+c.ID+'" class="btn btn-warning delete-btn">Delete Part</button>';var d,e,g="";if(c.InvoiceNos.length>10){var h=f(c.InvoiceNos,",",10);d=h.split(",");for(e in d)g+="<a href='#!/invoice-edit/"+d[e]+"/0/0'>"+d[e]+"</a>,";g+="....."}else{d=c.InvoiceNos.split(",");for(e in d)g+="<a href='#!/invoice-edit/"+d[e]+"/0/0'>"+d[e]+"</a>,"}return g},targets:2}],bJQueryUI:!0,processing:!0,serverSide:!1,ajax:"server/SelectPartInvoiceList.php?RoleName="+c.loginResult.RoleName+"&CompaniesID="+c.loginResult.CompaniesID});$("#partlist").on("click",".delete-btn",function(){var a=($(this).closest("tr"),$(this).data("id"));d.post("server/AjaxProcess.php",$.param({partID:a}),{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).success(function(a){1===Number(a)&&location.reload()})})}]),angular.module("myApp").controller("SettlementController",["AuthFactory","$rootScope","$http","$scope",function(a,b,c,d){a.checkLogin(),b.loginResult=a.getLoginDetail(),$("#InvDateFrom").datepicker({format:"dd/mm/yyyy"}),$("#InvDateTo").datepicker({format:"dd/mm/yyyy"}),c.get("server/SelectPayMethods.php",{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).success(function(a){d.paymethods=a}),d.search=function(){d.TotalAmount=0,d.PaidAmount=0;var a=$.param({InvDateFrom:d.InvDateFrom,InvDateTo:d.InvDateTo,QuotationYN:d.QuotationYN,PreviousYN:d.PreviousYN,PayMethodCd:d.PayMethodCd,CompaniesID:b.loginResult.CompaniesID});c.post("server/SearchSettlement.php",a,{headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).success(function(a){d.TotalAmount=a.TotalAmount,d.PaidAmount=a.PaidAmount})}}]),angular.module("userEdit").component("userEdit",{templateUrl:"user/user-edit.html",controller:["$route","AppAlert","$location","$rootScope","AuthFactory","$routeParams","Suburb","User","$scope",function(a,b,c,d,e,f,g,h,i){e.checkLogin(),d.loginResult=e.getLoginDetail(),i.ID=f.ID,i.loginID=d.loginResult.ID,this.querySearch=function(a){return g.search(a)},h.get(f.ID,d.loginResult.RolesID,function(a){i.user=null==a.user?{}:a.user,i.roles=a.roles,i.selectedSuburb=i.user.suburb,i.selectedItemChange=function(a){"object"==typeof a&&(i.user.state=a.value.split(",")[1],i.user.postcode=a.value.split(",")[2],i.user.suburb=a.display)}}),i.save=function(e){if("string"==typeof i.selectedSuburb?i.user.suburb=i.selectedSuburb:"object"==typeof i.selectedSuburb&&null!=i.selectedSuburb?i.user.suburb=i.selectedSuburb.label:i.user.suburb="",e.$invalid){var f=e.$error.required.map(function(a){return a.$name});b.add("warning","Entry is invalid. Required fields["+f.join(",")+"]");for(var g in f)e[f[g]].$touched=!0}else{i.user.action="SAVE",i.user.CompaniesID=d.loginResult.CompaniesID;var j=$.param(i.user);h.save(j,function(d){i.user.ID>0?1===parseInt(d.affectedRows,10)?b.add("success","User is successfully updated!",a.reload):""!==d.Error?b.add("danger","Error occurred.["+d.Error+"]"):b.add("warning","Nothing changed!"):parseInt(d.affectedRows,10)>0?b.add("success","User is successfully added!",function(){c.path("/user-list")}):""!==d.Error?b.add("danger","Error occurred.[]"+d.Error+"]"):b.add("warning","Nothing changed!")})}},i.delete=function(){i.user.action="DELETE";var a=$.param(i.user);h.save(a,function(a){1===parseInt(a.affectedRows,10)?b.add("success","User is successfully deleted!",function(){c.path("/user-list")}):b.add("danger","Error occurred.[]"+response.Error+"]")})}}]}),angular.module("myApp").controller("UserListController",["$http","AuthFactory","$rootScope","AppAlert","$location","$scope",function(a,b,c,d,e,f){b.checkLogin(),c.loginResult=b.getLoginDetail(),f.add=function(){e.path("/user-edit/0")},"Director"!==c.loginResult.RoleName&&"Super User"!==c.loginResult.RoleName&&d.add("warning","You are not allowed to access this page. Please log on as Director",function(){e.path("/login")});$("#userlist").dataTable({columnDefs:[{render:function(a,b,c){return c.ID},targets:0},{render:function(a,b,c){return'<a href="#!/user-edit/'+c.ID+'">'+c.FirstName+"</span>"},targets:1},{render:function(a,b,c){return c.LastName},targets:2},{render:function(a,b,c){return c.Phone},targets:3},{render:function(a,b,c){return c.Mobile},targets:4},{render:function(a,b,c){return c.RoleName},targets:5}],bJQueryUI:!0,processing:!0,serverSide:!1,ajax:"server/SelectUserList.php?RoleName="+c.loginResult.RoleName+"&CompaniesID="+c.loginResult.CompaniesID})}]);